// Variables
// =============================================================================

$grid-column: 60px !default; // can be px, em, or %
$grid-gutter: 20px !default; // can be px, em, or %
$grid-overlay: false !default; // generate visual grid overlay
$ie-support: false !default; // number of columns for IE fallback (must match a breakpoint)
$grid-direction: left !default; // switch to 'right' for rtl
$current-bp: 0; // init breakpoint variable

// Functions
// =============================================================================

// column widths for elements with .grid-cell class
@function fixed($col) { @return $col * ( em($grid-column) + em($grid-gutter) ) }
@function fluid($col, $avail: $current-bp) { @return (100% / $avail) * $col }

// column width for elements not in grid
@function no-grid-fixed($col) { @return $col * ( em($grid-column) + em($grid-gutter) ) - em($grid-gutter) }

// Javascript hook
// =============================================================================
head { font-family: 'no-support'; }
@media (min-width: 0px) { head { font-family: 'mobile'; } }

// Breakpoint mixin
// =============================================================================

@mixin breakpoint($min: false, $max: false, $label: false, $orientation: false, $wrapper: true, $pixel-ratio: false) {

	// set current breakpoint for fluid function
	$current-bp: $min;

	// min width mq
	@if ($min and $max == false) {
		@if ($min > 0) {
    		// create min width mq
    		// can we remove duplication of code here?
    		@if ($orientation) {
        		@media ( min-width: fixed($min) + em($grid-gutter) ) and ( orientation: $orientation ) {
            		@include breakpoint-extras($min, $wrapper, $label ) { @content };
        		}
    		} @else {
        		@media ( min-width: fixed($min) + em($grid-gutter) ) {
            		@include breakpoint-extras($min, $wrapper, $label ) { @content };
        		}
    		}
    		// ie fallback
    		@if ($ie-support and $min <= $ie-support and $orientation == false) {
    			.lt-ie9 {
                    @include breakpoint-extras($min, $wrapper, $label: false, $grid-overlay: false) { @content };
    			}
    		}
		}
	}

	// max width mq
	@if ($max) {
		// create max only mq
		@if ($min == 0 or $min == false) {
    		@if ($orientation) {
            	@media ( max-width: fixed($max) + em($grid-gutter) ) and ( orientation: $orientation ) { @content }
    		} @else {
        		@media ( max-width: fixed($max) + em($grid-gutter) ) { @content }
    		}
		// create min and max mq
		} @else {
    		@if ($orientation) {
        		@media ( min-width: fixed($min) + em($grid-gutter) ) and ( max-width: fixed($max) + em($grid-gutter) ) and ( orientation: $orientation ) { @content }
    		} @else {
            	@media ( min-width: fixed($min) + em($grid-gutter) ) and ( max-width: fixed($max) + em($grid-gutter) ) { @content }
    		}
		}
	}

	// orientation only mq
	@if ($min == false and $max == false) {
    	@if ($orientation) {
        	@media ( orientation: $orientation ) { @content }
    	}
	}

	// pixel ratio mq
	@if ($pixel-ratio) {
    	@media ( -webkit-min-device-pixel-ratio: $pixel-ratio), ( min-device-pixel-ratio: $pixel-ratio) { @content }
	}

}

// private mixin for generating extras in a min width mq
@mixin breakpoint-extras($min, $wrapper, $label, $grid-overlay) {
	@if($grid-overlay) { @include grid-overlay($min); }
	// create hook for js
	@if($label) { head { font-family: $label; } }
	// proper sizing of wrapper
    @if($wrapper) { .wrapper { width: fixed($min) - em($grid-gutter); margin-left: auto; margin-right: auto; } }
	@content
}

// Grid overlay
// =============================================================================

@mixin grid-overlay($col: false) {
	body::after {
		content: ''; position: fixed; top: 0; bottom: 0; pointer-events: none;
		@include background(linear-gradient(left, transparent $grid-gutter, transparentize(red, .9) $grid-gutter, transparentize(red, .9) $grid-gutter + $grid-column));
		@if ($col) {
			left: 50%;
			width: fixed($col) + em($grid-gutter); margin-left: fixed($col) / -2 - (em($grid-gutter)/2);
			@include background-size($grid-gutter + $grid-column);
		} @else {
			left: 0; right: $grid-gutter;
			@include background-size(25%);
		}
	}
}
@if($grid-overlay) { @include grid-overlay; }